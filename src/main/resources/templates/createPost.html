<!doctype html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org" data-bs-theme="dark">
<head>
  <div th:replace="~{fragments/setup :: setup}"/>
</head>
<body class="bg-body-tertiary">
  <main>
    <div th:insert="~{fragments/header :: header}"></div>

    <div class="container">
        <div class="py-5 text-center">
          <h2>견적 공유글 작성 페이지</h2>
        </div>

        <div class="row">
          <div>
            <form class="needs-validation" novalidate>

              <div>
                <h4>제목</h4>
                <input type="text" class="form-control" id="title" placeholder="" value="" required>
              </div>

              <hr class="my-4">

              <div class="py-2">
                <h4>태그</h4>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" name="tag" id="tag1">
                  <label class="form-check-label" for="tag1">게이밍</label>
                </div>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" name="tag" id="tag2">
                  <label class="form-check-label" for="tag2">작업</label>
                </div>
              </div>

              <hr class="my-4">

              <div class="col-md-5">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                  <span class="text">현재 견적</span>
                </h4>
                <ul class="list-group mb-3">
                  <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">케이스</h6>
                      <small class="text-body-secondary" value="${Estimate.case}">부품명</small>
                    </div>
                  </li>
                  <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">CPU 쿨러</h6>
                      <small class="text-body-secondary" value="${Estimate.cpuCooler}">부품명</small>
                    </div>
                  </li>
                  <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">CPU</h6>
                      <small class="text-body-secondary" value="${Estimate.cpu}">부품명</small>
                    </div>
                  </li>
                  <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">저장장치</h6>
                      <small class="text-body-secondary" value="${Estimate.dataStorage}">부품명</small>
                    </div>
                  </li>
                  <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">그래픽카드</h6>
                      <small class="text-body-secondary" value="${Estimate.graphicsCard}">부품명</small>
                    </div>
                  </li>
                  <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">메모리</h6>
                      <small class="text-body-secondary" value="${Estimate.memory}">부품명</small>
                    </div>
                  </li>
                  <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">메인보드</h6>
                      <small class="text-body-secondary" value="${Estimate.motherBoard}">부품명</small>
                    </div>
                  </li>
                  <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">파워서플라이</h6>
                      <small class="text-body-secondary" value="${Estimate.powerSupply}">부품명</small>
                    </div>
                  </li>
                </ul>
              </div>

              <hr class="my-4">

              <div class="py-2">
                <h4>본문</h4>
                <textarea class="form-control" id="content" rows="5"></textarea>
              </div>

              <hr class="my-4">

              <div class="d-grid gap-2 d-md-block">
                <button class="btn btn-primary btn-lg" type="submit" id="submitPost">작성</button>
                <button class="btn btn-secondary btn-lg" type="submit" id="cancel">취소</button>
              </div>
            </form>
          </div>
        </div>

    </div>
  </main>
  <footer class="py-5 text-body-secondary text-center text-small">
    <p class="mb-1">&copy; 2023 CusCom</p>
  </footer>
  <script type="text/javascript">

        document.getElementById('submitPost')
            .addEventListener('click',function(event){

                const selectedTags = Array.from(document.querySelectorAll('input[name="tag"]:checked'))
                                        .map(checkbox => checkbox.value);

                const postData={
                    _id:"",
                    estimateID: "[[${Estimate._id}]]",
                    title: document.getElementById('title').value,
                    content: document.getElementById('content').value,
                    tags: selectedTags,
                    viewCount: 0,
                    likeCount: 0
                };

                fetch("/CusCom/uploadPost", {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json"
                    },
                    body: JSON.stringify(postData)
                })
                .then(response => console.log(response))
                .catch(error => {
                    console.error("Error:", error);
                });
                window.location.href='/CusCom/SharePlace';
            });

        document.getElementById('cancel')
            .addEventListener('click',function(event){
                history.go(-1);
            });
  </script>
</body>
</html>