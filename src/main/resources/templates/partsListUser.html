<!doctype html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org" data-bs-theme="dark">
<head>
    <div th:replace="~{fragments/setup :: setup}"/>
    <style>
    tr{
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .button-group {
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>
<main>
    <div class="container-fluid">
        <div th:insert="~{fragments/header :: header}"></div>

        <div class="row">
            <div class="col-md-5 col-lg-4 py-5 order-md-last">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text">현재 견적</span>
                </h4>
                <ul class="list-group mb-3">
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <small class="text-body-secondary">케이스</small>
                            <h6 class="my-0" id="caseH6" th:text="${estimate.desktopCase}">부품명</h6>
                        </div>
                    </li>
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <small class="text-body-secondary">CPU 쿨러</small>
                            <h6 class="my-0" id="cpuCoolerH6" th:text="${estimate.cpuCooler}">부품명</h6>
                        </div>
                    </li>
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <small class="text-body-secondary">CPU</small>
                            <h6 class="my-0" id="cpuH6" th:text="${estimate.cpu}">부품명</h6>
                        </div>
                    </li>
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <small class="text-body-secondary">저장장치</small>
                            <h6 class="my-0" id="dataStorageH6" th:text="${estimate.dataStorage}">부품명</h6>
                        </div>
                    </li>
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <small class="text-body-secondary">그래픽카드</small>
                            <h6 class="my-0" id="graphicsCardH6" th:text="${estimate.graphicsCard}">부품명</h6>
                        </div>
                    </li>
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <small class="text-body-secondary">메모리</small>
                            <h6 class="my-0" id="memoryH6" th:text="${estimate.memory}">부품명</h6>
                        </div>
                    </li>
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <small class="text-body-secondary">메인보드</small>
                            <h6 class="my-0" id="motherBoardH6" th:text="${estimate.motherBoard}">부품명</h6>
                        </div>
                    </li>
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <small class="text-body-secondary">파워서플라이</small>
                            <h6 class="my-0" id="powerSupplyH6" th:text="${estimate.powerSupply}">부품명</h6>
                        </div>
                    </li>
                </ul>
                <div>
                    <button type="submit" class="btn btn-primary" id="submitEstimate">견적 저장</button>
                    <button type="submit" class="btn btn-secondary" id="cancel">취소</button>
                </div>
            </div>

            <div class="accordion py-5" id="partsList" style="width:60%; overflow:auto;">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCase" aria-expanded="true" aria-controls="collapseOne">
                            Case
                        </button>
                    </h2>
                    <div id="collapseCase" class="accordion-collapse collapse show" data-bs-parent="#partsList">
                        <div class="accordion-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="case : ${caseList}">
                                    <td th:text="${case.name}">케이스 이름</td>
                                    <td>
                                        <div class="button-container" style="display: flex;">
                                            <button class="btn btn-primary btn-add" datatype="desktopCase">담기</button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCPUCooler" aria-expanded="true" aria-controls="collapseOne">
                            CPUCooler
                        </button>
                    </h2>
                    <div id="collapseCPUCooler" class="accordion-collapse collapse" data-bs-parent="#partsList">
                        <div class="accordion-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="cpuCooler : ${cpuCoolerList}">
                                    <td th:text="${cpuCooler.name}">쿨러 이름</td>
                                    <td>
                                        <div class="button-container" style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary btn-add" datatype="cpuCooler">담기</button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCPU" aria-expanded="true" aria-controls="collapseOne">
                            CPU
                        </button>
                    </h2>
                    <div id="collapseCPU" class="accordion-collapse collapse" data-bs-parent="#partsList">
                        <div class="accordion-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="cpu : ${cpuList}">
                                    <td th:text="${cpu.name}">CPU 이름</td>
                                    <td>
                                        <div class="button-container" style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary btn-add" datatype="cpu">담기</button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDataStorage" aria-expanded="true" aria-controls="collapseOne">
                            DataStorage
                        </button>
                    </h2>
                    <div id="collapseDataStorage" class="accordion-collapse collapse" data-bs-parent="#partsList">
                        <div class="accordion-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="dataStorage : ${dataStorageList}">
                                    <td th:text="${dataStorage.name}">저장장치 이름</td>
                                    <td>
                                        <div class="button-container" style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary btn-add" datatype="dataStorage">담기</button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGraphicsCard" aria-expanded="true" aria-controls="collapseOne">
                            GraphicsCard
                        </button>
                    </h2>
                    <div id="collapseGraphicsCard" class="accordion-collapse collapse" data-bs-parent="#partsList">
                        <div class="accordion-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="graphicsCard : ${graphicsCardList}">
                                    <td th:text="${graphicsCard.name}">그래픽카드 이름</td>
                                    <td>
                                        <div class="button-container" style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary btn-add" datatype="graphicsCard">담기</button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMemory" aria-expanded="true" aria-controls="collapseOne">
                            Memory
                        </button>
                    </h2>
                    <div id="collapseMemory" class="accordion-collapse collapse" data-bs-parent="#partsList">
                        <div class="accordion-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="memory : ${memoryList}">
                                    <td th:text="${memory.name}">메모리 이름</td>
                                    <td>
                                        <div class="button-container" style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary btn-add" datatype="memory">담기</button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMotherBoard" aria-expanded="true" aria-controls="collapseOne">
                            MotherBoard
                        </button>
                    </h2>
                    <div id="collapseMotherBoard" class="accordion-collapse collapse" data-bs-parent="#partsList">
                        <div class="accordion-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="motherBoard : ${motherBoardList}">
                                    <td th:text="${motherBoard.name}">마더보드 이름</td>
                                    <td>
                                        <div class="button-container" style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary btn-add" datatype="motherBoard">담기</button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePowerSupply" aria-expanded="true" aria-controls="collapseOne">
                            PowerSupply
                        </button>
                    </h2>
                    <div id="collapsePowerSupply" class="accordion-collapse collapse" data-bs-parent="#partsList">
                        <div class="accordion-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="powerSupply : ${powerSupplyList}">
                                    <td th:text="${powerSupply.name}">파워서플라이 이름</td>
                                    <td>
                                        <div class="button-container" style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary btn-add" datatype="powerSupply">담기</button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</main>
<footer class="my-5 pt-5 text-body-secondary text-center text-small">
    <p class="mb-1">&copy; 2023 CusCom</p>
</footer>
<script type="text/javascript">

    var data = {
        userName:"[[${userName}]]",
        cpu:"[[${estimate.cpu}]]",
        motherBoard:"[[${estimate.motherBoard}]]",
        memory:"[[${estimate.memory}]]",
        dataStorage:"[[${estimate.dataStorage}]]",
        graphicsCard:"[[${estimate.graphicsCard}]]",
        cpuCooler:"[[${estimate.cpuCooler}]]",
        powerSupply:"[[${estimate.powerSupply}]]",
        desktopCase:"[[${estimate.desktopCase}]]"
    }

    function updateH6Text(id, text) {
        const h6Element = document.getElementById(id);
        if (h6Element) {
            h6Element.textContent = text;
        }
    }

    document.querySelectorAll('.btn-add').forEach(function(button){
        button.addEventListener('click',function(){addParts(button);});
    });

    function addParts(button){
        var name=button.closest('tr').querySelector('td:first-child').innerText;
        var datatype=button.getAttribute('datatype');
        console.log("상품명: "+name+"부품유형"+datatype);
        switch(datatype){
            case 'cpu':
                data.cpu=name;
                updateH6Text("cpuH6",name);
                break;
            case 'motherBoard':
                data.motherBoard=name;
                updateH6Text("motherBoardH6",name);
                break;
            case 'memory':
                data.memory=name;
                updateH6Text("memoryH6",name);
                break;
            case 'dataStorage':
                data.dataStorage=name;
                updateH6Text("dataStorageH6",name);
                break;
            case 'graphicsCard':
                data.graphicsCard=name;
                updateH6Text("graphicsCardH6",name);
                break;
            case 'cpuCooler':
                data.cpuCooler=name;
                updateH6Text("cpuCoolerH6",name);
                break;
            case 'powerSupply':
                data.powerSupply=name;
                updateH6Text("powerSupplyH6",name);
                break;
            case 'desktopCase':
                data.desktopCase=name;
                updateH6Text("caseH6",name);
                break;
            default:
                console.log("분류되지 않은 데이터");
                break;
        }
    }

    document.getElementById('submitEstimate')
            .addEventListener('click',function(event){
                const formData = new FormData();
                formData.append('estimate', JSON.stringify(data));

                fetch("/CusCom/estimate",{
                    method: "POST",
                    body: formData
                })
                    .then(response => console.log(response))
                    .catch(error => {
                        console.error("Error:", error);
                    });
                window.location.href='/CusCom/mainPage';
            });

    document.getElementById('cancel')
            .addEventListener('click',function(event){
                history.go(-1);
            });
  </script>
</body>
</html>